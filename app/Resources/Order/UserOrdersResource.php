<?php/** * Created by PhpStorm. * User: mytoken * Date: 2019-06-26 * Time: 17:14 */namespace App\Resources\Order;use App\Ship\Http\Json\ApiResource;class UserOrdersResource extends ApiResource{    public $resources;    public function toArray($request)    {        return [            'orderNumber'  => $this->resource->id,            'goods'   => $this->getGoods(),            'created_at' => date('Y-m-d H:i:s', strtotime($this->resource->created_at)),            'order_total' => $this->resource->amount,            'status' => $this->resource->status,            'remark' => $this->resource->remark,            'item_count' => $this->getOrderItemCount(),            'status_str' => $this->resource->orderStatusStr,            'id' => $this->resource->id,        ];    }    protected function getOrderItemCount()    {        return count($this->resource->orderItems);    }    protected function getGoods()    {        $goodList = [];        foreach ($this->resource->orderItems as $goods) {            if (!strlen($goods['product']['cover'])) {                continue;            }            if (!strpos($goods['product']['cover'],',')) {                $firstPath = $goods['product']['cover'];            } else {                $firstPath = substr($goods['product']['cover'], 0, strpos($goods['product']['cover'],','));            }            $firstCover = sprintf('%s%s', env('QINU_CDN'), $firstPath);            if (!isset($goodList[$goods['id']])) {                $goodList[$goods['id']] = [                    'img' => $firstCover                ];            }        }        return $goodList;    }}